---
- name: "nvm: check if installed"
  shell: |
    [ -s "${HOME}/.nvm/nvm.sh" ] && source "${HOME}/.nvm/nvm.sh"
    nvm --version
  register: nvm_installed
  ignore_errors: true
  changed_when: false
  args:
    executable: "{{ current_shell }}"
- name: "nvm: download"
  when: nvm_installed is failed
  get_url:
    url: https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.2/install.sh
    dest: /tmp/install.sh
    mode: "0755"
    force: "yes"
- name: "nvm: install"
  when: nvm_installed is failed
  shell: /tmp/install.sh
  args:
    executable: "{{ current_shell }}"
- name: "node: install"
  shell: |
    source "${HOME}/.nvm/nvm.sh"
    nvm install node
    nvm use node
  when: nvm_installed is failed
  args:
    executable: "{{ current_shell }}"
